# API для платежной системы

API для сайта с платежной системой [Stripe](stripe.com/docs). 
Stripe - платёжная система с подробным API и бесплатным тестовым режимом для 
имитации и тестирования платежей.  В данном проекте реализован простой 
сервер с одной html страничкой, который общается со Stripe и создает платёжные
формы для товаров. 

## Демо-версия сайта
Демо-версия сайта расположена на бесплатном хостинге [heroku.com](https://id.heroku.com/login)

- [Адрес демо-версии](https://fsk-payment.herokuapp.com/)
- [Админка демо-версии](https://fsk-payment.herokuapp.com/admin/)
  - login: `user`
  - пароль: `password`
  - [Документация Openapi](https://fsk-payment.herokuapp.com/api/docs/)


## Как запустить сайт

Проект докеризирован. Для запуска сайта воспользуйтесь командой:

```sh
docker-compose up 
```


В новом терминале не выключая сайт создайте суперпользователя для доступа к админке:

```sh
docker-compose run django ./manage.py createsuperuser
```


### Переменные окружения

Часть настроек проекта берётся из переменных окружения. 
Чтобы их определить, создайте файл `.env` рядом с `manage.py` 
и запишите туда данные в таком формате: `ПЕРЕМЕННАЯ=значение`.

Используются следующие переменные окружения: 
- `DEBUG` — дебаг-режим. Поставьте True, чтобы увидеть отладочную информацию в случае ошибки.
- `SECRET_KEY` — секретный ключ проекта
- `ALLOWED_HOSTS` - адреса, на которых будет обслуживаться сайт
- `DATABASE_URL` - URL, в котором содержатся данные о БД, которые распарсятся с [помощью](https://github.com/sloria/environs#usage-with-django). В данном проекте используется `PostgreSQL`, развернут в докере.
- `STRIPE_PUBLISHABLE_KEY` - публичный ключ API платёжной системы Stripe. Для его получения необходимо зарегистрироваться на [сайте платежной системы](https://dashboard.stripe.com/login). Далее перейти по [ссылке](https://dashboard.stripe.com/test/apikeys). В разделе `Standard keys` вы увидите `Publishable key`, это и есть нужный вам ключ. 
- `STRIPE_SECRET_KEY` - секретный ключ API платёжной системы Stripe. Для его получения необходимо зарегистрироваться на [сайте платежной системы](https://dashboard.stripe.com/login). Далее перейти по [ссылке](https://dashboard.stripe.com/test/apikeys). В разделе `Standard keys` вы увидите `Secret key`, это и есть нужный вам ключ.

Для всех переменных, кроме API ключей для `Stripe`, установлены значения по умолчанию


## Документация по API

### Информация о выбранном товаре
- Метод: `GET`
- Права доступа: `Любой пользователь`
- URL: `api/item/{id}/`

В результате запроса показывается простейшая HTML страница, на которой выводится информация о 
выбранном товаре и кнопка `Buy`. По нажатию на кнопку `Buy` происходит редирект 
на форму оплаты товара.

### Информация о выбранном заказе
- Метод: `GET`
- Права доступа: `Любой пользователь`
- URL: `api/order/{id}/`

В результате запроса показывается простейшая HTML страница, на которой выводится информация о 
выбранном заказе и кнопка `Buy`. По нажатию на кнопку `Buy` происходит редирект 
на форму оплаты заказа.

### Получение Stripe Session Id для оплаты выбранного Item
- Метод: `GET`
- Права доступа: `Любой пользователь`
- URL: `api/buy_item/{id}/`

В результате запроса выдается `session.id`, который далее используется для оплаты товара

### Получение Stripe Session Id для оплаты выбранного Order
- Метод: `GET`
- Права доступа: `Любой пользователь`
- URL: `api/buy_order/{id}/`

В результате запроса выдается `session.id`, который далее используется для оплаты заказа

Для просмотра запросов API перейдите по [ссылке](http://0.0.0.0:8000/api/docs/)

Для просмотра спецификации по API перейдите по [ссылке](http://0.0.0.0:8000/api/schema/)


## Технологии
django, djangorestframework, docker, docker-compose